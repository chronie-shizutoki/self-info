<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">è‡ªæˆ‘ä»‹ç»ç½‘ç«™</title>
    <link rel="stylesheet" href="components/style.css">
    <link rel="stylesheet" href="components/liquid-glass-block.css">
    <link rel="stylesheet" href="components/birthday.css">
    <link rel="stylesheet" href="components/splash-screen.css">
    <style>
        /* ç»ç’ƒè´¨æ„Ÿç®¡ç†é¢æ¿ */
        .management-panel {
            position: fixed;
            top: 0;
            right: -420px;
            width: 420px;
            height: 100vh;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border-left: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
            color: white;
            z-index: 10000;
            transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            overflow-y: auto;
        }
        
        .management-panel.show {
            right: 0;
        }
        
        .panel-header {
            padding: 25px 20px;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(10px);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .panel-title {
            margin: 0;
            font-size: 18px;
            font-weight: 600;
            color: var(--primary-color, #a6deff);
            text-shadow: 0 0 10px rgba(166, 222, 255, 0.3);
        }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 35px;
            height: 35px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }
        
        .panel-content {
            padding: 20px;
        }
        
        .glass-section {
            margin-bottom: 25px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .section-title {
            margin: 0 0 15px 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--primary-color, #a6deff);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 6px;
            font-size: 14px;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 14px;
            box-sizing: border-box;
            transition: all 0.3s ease;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color, #a6deff);
            background: rgba(255, 255, 255, 0.12);
            box-shadow: 0 0 0 3px rgba(166, 222, 255, 0.1);
        }
        
        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }
        
        .glass-btn {
            padding: 12px 20px;
            border: none;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 4px;
            position: relative;
            overflow: hidden;
        }
        
        .glass-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.2);
        }
        
        .glass-btn:active {
            transform: translateY(0);
        }
        
        .glass-btn.primary {
            background: linear-gradient(135deg, var(--primary-color, #a6deff) 0%, rgba(166, 222, 255, 0.8) 100%);
            color: #000;
        }
        
        .glass-btn.success {
            background: linear-gradient(135deg, #4CAF50 0%, rgba(76, 175, 80, 0.8) 100%);
        }
        
        .glass-btn.warning {
            background: linear-gradient(135deg, #FF9800 0%, rgba(255, 152, 0, 0.8) 100%);
        }
        
        .glass-btn.danger {
            background: linear-gradient(135deg, #f44336 0%, rgba(244, 67, 54, 0.8) 100%);
        }
        
        .glass-btn.full-width {
            width: 100%;
            margin: 8px 0;
        }
        
        .management-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 55px;
            height: 55px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 22px;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .management-toggle:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.05) rotate(90deg);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
        }
        
        .language-switcher {
            position: fixed;
            top: 85px;
            right: 20px;
            z-index: 9998;
            padding: 10px 15px;
            border-radius: 12px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        }
        
        .language-switcher:hover {
            background: rgba(255, 255, 255, 0.15);
        }
        
        .block-item {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            padding: 16px;
            margin: 12px 0;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        
        .block-item:hover {
            background: rgba(255, 255, 255, 0.08);
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }
        
        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .block-title {
            font-weight: 600;
            color: white;
            font-size: 15px;
        }
        
        .block-type {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.6);
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 10px;
            border-radius: 20px;
            backdrop-filter: blur(5px);
        }
        
        .block-controls {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .block-controls .glass-btn {
            padding: 6px 12px;
            font-size: 12px;
            margin: 2px;
        }
        
        .color-group {
            display: flex;
            align-items: center;
            gap: 12px;
            background: rgba(255, 255, 255, 0.05);
            padding: 12px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .color-preview:hover {
            transform: scale(1.1);
            border-color: rgba(255, 255, 255, 0.4);
        }
        
        .color-input {
            opacity: 0;
            position: absolute;
            pointer-events: none;
        }
        
        .color-text {
            flex: 1;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            padding: 8px 12px;
            border-radius: 8px;
            color: white;
            font-size: 13px;
            font-family: monospace;
        }
        
        @media (max-width: 500px) {
            .management-panel {
                width: 100%;
                right: -100%;
            }
            
            .management-toggle {
                top: 15px;
                right: 15px;
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .language-switcher {
                top: 70px;
                right: 15px;
                font-size: 12px;
                padding: 8px 12px;
            }
            
            .glass-section {
                padding: 15px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="splash-screen hidden">
        <div class="splash-content-girl">
            <div class="loader"></div>
            <p class="splash-text" data-i18n="loading.text">åŠ è½½ä¸­...</p>
        </div>
    </div>

    <!-- Language Switcher -->
    <select id="language-switcher" class="language-switcher">
        <option value="default">é»˜è®¤æç¤º</option>
        <option value="en">English</option>
        <option value="ja">æ—¥æœ¬èª</option>
        <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
        <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
    </select>

    <!-- Management Panel -->
    <div id="management-panel" class="management-panel">
        <div class="panel-header">
            <h3 class="panel-title" data-i18n="management.title">ğŸ¨ å†…å®¹ç®¡ç†ç³»ç»Ÿ</h3>
            <button id="close-panel" class="close-btn">Ã—</button>
        </div>
        <div class="panel-content">
            <!-- é¡µé¢è®¾ç½® -->
            <div class="glass-section">
                <h4 class="section-title">
                    ğŸ“„ <span data-i18n="management.page_settings">é¡µé¢è®¾ç½®</span>
                </h4>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.page_title_label">é¡µé¢æ ‡é¢˜</label>
                    <input type="text" id="page-title-input" class="form-input" data-i18n-placeholder="management.page_title_placeholder" placeholder="è¯·è¾“å…¥é¡µé¢æ ‡é¢˜">
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.background_label">èƒŒæ™¯å›¾ç‰‡</label>
                    <input type="text" id="background-input" class="form-input" data-i18n-placeholder="management.background_placeholder" placeholder="è¯·è¾“å…¥èƒŒæ™¯å›¾ç‰‡URLæˆ–è·¯å¾„">
                </div>
            </div>
            
            <!-- å†…å®¹å—ç®¡ç† -->
            <div class="glass-section">
                <h4 class="section-title">
                    ğŸ“ <span data-i18n="management.content_management">å†…å®¹å—ç®¡ç†</span>
                </h4>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.block_type_label">å†…å®¹å—ç±»å‹</label>
                    <select id="block-type" class="form-select">
                        <option value="header" data-i18n="block_types.header">æ ‡é¢˜å—</option>
                        <option value="text" data-i18n="block_types.text">æ–‡æœ¬å—</option>
                        <option value="list" data-i18n="block_types.list">åˆ—è¡¨å—</option>
                        <option value="custom" data-i18n="block_types.custom">è‡ªå®šä¹‰å—</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.block_title_label">å†…å®¹å—æ ‡é¢˜</label>
                    <input type="text" id="block-title" class="form-input" data-i18n-placeholder="management.block_title_placeholder" placeholder="è¯·è¾“å…¥å†…å®¹å—æ ‡é¢˜">
                </div>
                <button class="glass-btn success full-width" onclick="addBlock()">
                    <span data-i18n="management.add_block">+ æ·»åŠ å†…å®¹å—</span>
                </button>
                
                <div id="blocks-list" style="margin-top: 20px;"></div>
            </div>
            
            <!-- æ ·å¼è®¾ç½® -->
            <div class="glass-section">
                <h4 class="section-title">
                    ğŸ¨ <span data-i18n="management.style_settings">æ ·å¼è®¾ç½®</span>
                </h4>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.primary_color">ä¸»è‰²è°ƒ</label>
                    <div class="color-group">
                        <div class="color-preview" id="primary-color-preview" onclick="document.getElementById('primary-color').click()"></div>
                        <input type="color" id="primary-color" class="color-input" value="#a6deff">
                        <input type="text" id="primary-color-text" class="color-text" value="#a6deff">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.highlight_color">é«˜äº®è‰²</label>
                    <div class="color-group">
                        <div class="color-preview" id="highlight-color-preview" onclick="document.getElementById('highlight-color').click()"></div>
                        <input type="color" id="highlight-color" class="color-input" value="#dbA6ff">
                        <input type="text" id="highlight-color-text" class="color-text" value="#dbA6ff">
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" data-i18n="management.text_color">æ–‡æœ¬è‰²</label>
                    <div class="color-group">
                        <div class="color-preview" id="text-color-preview" onclick="document.getElementById('text-color').click()"></div>
                        <input type="color" id="text-color" class="color-input" value="#ffa6d3">
                        <input type="text" id="text-color-text" class="color-text" value="#ffa6d3">
                    </div>
                </div>
            </div>
            
            <!-- é…ç½®ç®¡ç† -->
            <div class="glass-section">
                <h4 class="section-title">
                    ğŸ’¾ <span data-i18n="management.config_management">é…ç½®ç®¡ç†</span>
                </h4>
                <button class="glass-btn primary full-width" onclick="saveConfig()">
                    ğŸ’¾ <span data-i18n="management.save_config">ä¿å­˜é…ç½®</span>
                </button>
                <button class="glass-btn warning full-width" onclick="exportConfig()">
                    ğŸ“¤ <span data-i18n="management.export_config">å¯¼å‡ºé…ç½®</span>
                </button>
                <button class="glass-btn primary full-width" onclick="document.getElementById('import-file').click()">
                    ğŸ“¥ <span data-i18n="management.import_config">å¯¼å…¥é…ç½®</span>
                </button>
                <input type="file" id="import-file" style="display: none" accept=".json" onchange="importConfig(event)">
                <button class="glass-btn danger full-width" onclick="resetConfig()">
                    ğŸ”„ <span data-i18n="management.reset_config">é‡ç½®é…ç½®</span>
                </button>
            </div>
        </div>
    </div>
    
    <!-- Management Toggle Button -->
    <button class="management-toggle" onclick="togglePanel()">âš™ï¸</button>
    
    <!-- Content Container -->
    <div id="content-container"></div>

    <!-- Scripts -->
    <script src="components/birthday.js"></script>
    <script src="components/splash-screen.js"></script>
    <script type="module" src="anime/sakura.js"></script>
    
    <script>
        // å…¨å±€é…ç½®å¯¹è±¡
        let config = {
            pageInfo: {
                title: "è‡ªæˆ‘ä»‹ç»ç½‘ç«™",
                language: "default"
            },
            styles: {
                backgroundImage: "components/background.jpeg",
                primaryColor: "#a6deff",
                highlightColor: "#dbA6ff",
                infoTextColor: "#ffa6d3",
                fontFamily: "KleeOne-Regular"
            },
            contentBlocks: [
                {
                    id: "header",
                    type: "header",
                    enabled: true,
                    title: "ä¸ªäººä¿¡æ¯",
                    content: {
                        greeting: "è¯·è¾“å…¥é—®å€™è¯­",
                        name: "è¯·è¾“å…¥æ‚¨çš„å§“å",
                        subtitle: "è¯·è¾“å…¥å‰¯æ ‡é¢˜"
                    },
                    styles: {
                        textAlign: "center",
                        backgroundColor: "rgba(255, 255, 255, 0.1)",
                        padding: "20px",
                        borderRadius: "24px"
                    }
                },
                {
                    id: "about",
                    type: "text",
                    enabled: true,
                    title: "ğŸŒŸ å…³äºæˆ‘",
                    content: {
                        text: "è¯·è¾“å…¥å…³äºæ‚¨çš„ä»‹ç»æ–‡æœ¬ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œå†™ä»»ä½•æƒ³è¦åˆ†äº«çš„å†…å®¹ã€‚"
                    },
                    styles: {
                        backgroundColor: "rgba(255, 255, 255, 0.1)",
                        padding: "20px",
                        borderRadius: "24px"
                    }
                }
            ]
        };

        // å›½é™…åŒ–æ”¯æŒ
        const i18n = {
            currentLang: 'default',
            translations: {},

            async loadTranslations(lang) {
                try {
                    // åŠ è½½UIç¿»è¯‘
                    const uiFile = lang === 'default' ? 'ui.json' : `ui-${lang}.json`;
                    const response = await fetch(`./locales/${uiFile}`);
                    if (response.ok) {
                        this.translations[lang] = await response.json();
                    } else {
                        // å›é€€åˆ°é»˜è®¤UIæ–‡ä»¶
                        const defaultResponse = await fetch('./locales/ui.json');
                        if (defaultResponse.ok) {
                            this.translations[lang] = await defaultResponse.json();
                        }
                    }
                } catch (error) {
                    console.error(`Could not load translations for ${lang}:`, error);
                    if (lang !== 'default' && !this.translations['default']) {
                        await this.loadTranslations('default');
                    }
                }
            },

            translate(key, defaultValue = '') {
                const keys = key.split('.');
                let result = this.translations[this.currentLang];
                for (const k of keys) {
                    if (result && typeof result === 'object' && k in result) {
                        result = result[k];
                    } else {
                        // å›é€€åˆ°é»˜è®¤è¯­è¨€
                        result = this.translations['default'];
                        if (result) {
                            for (const ek of keys) {
                                if (result && typeof result === 'object' && ek in result) {
                                    result = result[ek];
                                } else {
                                    return defaultValue;
                                }
                            }
                        }
                        break;
                    }
                }
                return result || defaultValue;
            },

            async setLanguage(lang) {
                if (!this.translations[lang]) {
                    await this.loadTranslations(lang);
                }
                this.currentLang = lang;
                localStorage.setItem('lang', lang);
                this.applyTranslations();
                this.updateContentDefaults();
            },

            applyTranslations() {
                // ç¿»è¯‘å¸¦æœ‰data-i18nå±æ€§çš„å…ƒç´ 
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const translation = this.translate(key);
                    if (translation) {
                        element.textContent = translation;
                    }
                });

                // ç¿»è¯‘placeholder
                document.querySelectorAll('[data-i18n-placeholder]').forEach(element => {
                    const key = element.getAttribute('data-i18n-placeholder');
                    const translation = this.translate(key);
                    if (translation) {
                        element.placeholder = translation;
                    }
                });

                // ç¿»è¯‘é€‰é¡¹
                document.querySelectorAll('option[data-i18n]').forEach(option => {
                    const key = option.getAttribute('data-i18n');
                    const translation = this.translate(key);
                    if (translation) {
                        option.textContent = translation;
                    }
                });
            },

            updateContentDefaults() {
                // æ ¹æ®å½“å‰è¯­è¨€æ›´æ–°é»˜è®¤å†…å®¹
                const defaults = this.translate('content_defaults', {});
                config.contentBlocks.forEach(block => {
                    if (block.type === 'header') {
                        if (block.content.greeting === 'è¯·è¾“å…¥é—®å€™è¯­' || block.content.greeting === 'Enter greeting') {
                            block.content.greeting = defaults.greeting || 'è¯·è¾“å…¥é—®å€™è¯­';
                        }
                        if (block.content.name === 'è¯·è¾“å…¥æ‚¨çš„å§“å' || block.content.name === 'Enter your name') {
                            block.content.name = defaults.name || 'è¯·è¾“å…¥æ‚¨çš„å§“å';
                        }
                        if (block.content.subtitle === 'è¯·è¾“å…¥å‰¯æ ‡é¢˜' || block.content.subtitle === 'Enter subtitle') {
                            block.content.subtitle = defaults.subtitle || 'è¯·è¾“å…¥å‰¯æ ‡é¢˜';
                        }
                    } else if (block.type === 'text') {
                        if (block.content.text === 'è¯·è¾“å…¥å…³äºæ‚¨çš„ä»‹ç»æ–‡æœ¬ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œå†™ä»»ä½•æƒ³è¦åˆ†äº«çš„å†…å®¹ã€‚' || 
                            block.content.text === 'Enter your introduction text. You can write anything you want to share here.') {
                            block.content.text = defaults.about_text || 'è¯·è¾“å…¥å…³äºæ‚¨çš„ä»‹ç»æ–‡æœ¬ã€‚æ‚¨å¯ä»¥åœ¨è¿™é‡Œå†™ä»»ä½•æƒ³è¦åˆ†äº«çš„å†…å®¹ã€‚';
                        }
                    }
                });
                contentManager.applyConfig();
            }
        };

        // å†…å®¹æ¸²æŸ“å™¨
        class ContentRenderer {
            constructor(container) {
                this.container = container;
            }

            renderBlock(block) {
                if (!block.enabled) return null;

                const section = document.createElement('div');
                section.className = 'section';
                section.id = `block-${block.id}`;
                section.style.marginBottom = '25px';

                const glassContainer = document.createElement('div');
                glassContainer.className = 'glass-container-apple';
                
                // åº”ç”¨è‡ªå®šä¹‰æ ·å¼
                if (block.styles) {
                    Object.assign(glassContainer.style, block.styles);
                }

                // æ¸²æŸ“æ ‡é¢˜
                if (block.title) {
                    const title = document.createElement('h3');
                    title.className = 'section-title';
                    title.textContent = block.title;
                    glassContainer.appendChild(title);
                }

                // æ ¹æ®ç±»å‹æ¸²æŸ“å†…å®¹
                switch (block.type) {
                    case 'header':
                        this.renderHeader(glassContainer, block.content);
                        section.style.cssText = 'display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; text-align: center;';
                        break;
                    case 'text':
                        this.renderText(glassContainer, block.content);
                        break;
                    case 'list':
                        this.renderList(glassContainer, block.content);
                        break;
                    case 'custom':
                        this.renderCustom(glassContainer, block.content);
                        break;
                }

                section.appendChild(glassContainer);
                return section;
            }

            renderHeader(container, content) {
                if (content.greeting) {
                    const greeting = document.createElement('p');
                    greeting.className = 'info-text';
                    greeting.textContent = content.greeting;
                    container.appendChild(greeting);
                }

                if (content.name) {
                    const name = document.createElement('p');
                    const nameSpan = document.createElement('strong');
                    nameSpan.className = 'highlight';
                    nameSpan.textContent = content.name;
                    name.appendChild(nameSpan);
                    container.appendChild(name);
                }

                if (content.subtitle) {
                    const subtitle = document.createElement('p');
                    subtitle.className = 'info-text';
                    subtitle.textContent = content.subtitle;
                    container.appendChild(subtitle);
                }
            }

            renderText(container, content) {
                const text = document.createElement('p');
                text.className = 'info-text';
                text.textContent = content.text;
                container.appendChild(text);
            }

            renderList(container, content) {
                const list = document.createElement('ul');
                content.items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'info-text';
                    li.textContent = item;
                    list.appendChild(li);
                });
                container.appendChild(list);
            }

            renderCustom(container, content) {
                container.innerHTML += content.html;
            }

            renderAll() {
                this.container.innerHTML = '';

                // æ·»åŠ æ¨±èŠ±ç”»å¸ƒ
                const canvas = document.createElement('canvas');
                canvas.id = 'sakura-canvas';
                canvas.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;';
                this.container.appendChild(canvas);

                // æ¸²æŸ“æ‰€æœ‰å¯ç”¨çš„å†…å®¹å—
                config.contentBlocks.forEach(block => {
                    if (block.enabled) {
                        const blockElement = this.renderBlock(block);
                        if (blockElement) {
                            this.container.appendChild(blockElement);
                        }
                    }
                });
            }
        }

        // å†…å®¹ç®¡ç†å™¨
        class ContentManager {
            constructor() {
                this.renderer = new ContentRenderer(document.getElementById('content-container'));
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadSavedConfig();
                this.applyConfig();
                this.renderBlocksList();
                this.initI18n();
            }

            bindEvents() {
                // é¡µé¢è®¾ç½®äº‹ä»¶
                document.getElementById('page-title-input').addEventListener('input', (e) => {
                    config.pageInfo.title = e.target.value;
                    document.title = e.target.value;
                });

                document.getElementById('background-input').addEventListener('input', (e) => {
                    config.styles.backgroundImage = e.target.value;
                    this.applyStyles();
                });

                // é¢œè‰²è®¾ç½®äº‹ä»¶
                this.bindColorEvents('primary-color', 'primaryColor');
                this.bindColorEvents('highlight-color', 'highlightColor');
                this.bindColorEvents('text-color', 'infoTextColor');

                // é¢æ¿æ§åˆ¶
                document.getElementById('close-panel').addEventListener('click', () => {
                    document.getElementById('management-panel').classList.remove('show');
                });

                // è¯­è¨€åˆ‡æ¢
                document.getElementById('language-switcher').addEventListener('change', (e) => {
                    i18n.setLanguage(e.target.value);
                });
            }

            bindColorEvents(inputId, configKey) {
                const colorInput = document.getElementById(inputId);
                const textInput = document.getElementById(inputId + '-text');
                const preview = document.getElementById(inputId + '-preview');

                const updateColor = (color) => {
                    config.styles[configKey] = color;
                    colorInput.value = color;
                    textInput.value = color;
                    preview.style.backgroundColor = color;
                    this.applyStyles();
                };

                colorInput.addEventListener('input', (e) => updateColor(e.target.value));
                
                textInput.addEventListener('input', (e) => {
                    const color = e.target.value;
                    if (/^#[0-9A-F]{6}$/i.test(color)) {
                        updateColor(color);
                    }
                });

                // åˆå§‹åŒ–é¢„è§ˆè‰²å—
                preview.style.backgroundColor = config.styles[configKey];
            }

            applyConfig() {
                // åº”ç”¨é¡µé¢æ ‡é¢˜
                document.title = config.pageInfo.title;
                document.getElementById('page-title-input').value = config.pageInfo.title;

                // åº”ç”¨èƒŒæ™¯
                document.getElementById('background-input').value = config.styles.backgroundImage;

                // åº”ç”¨é¢œè‰²
                document.getElementById('primary-color').value = config.styles.primaryColor;
                document.getElementById('primary-color-text').value = config.styles.primaryColor;
                document.getElementById('primary-color-preview').style.backgroundColor = config.styles.primaryColor;
                
                document.getElementById('highlight-color').value = config.styles.highlightColor;
                document.getElementById('highlight-color-text').value = config.styles.highlightColor;
                document.getElementById('highlight-color-preview').style.backgroundColor = config.styles.highlightColor;
                
                document.getElementById('text-color').value = config.styles.infoTextColor;
                document.getElementById('text-color-text').value = config.styles.infoTextColor;
                document.getElementById('text-color-preview').style.backgroundColor = config.styles.infoTextColor;

                this.applyStyles();
                this.renderer.renderAll();
            }

            applyStyles() {
                document.body.style.setProperty('--background-image', `url("${config.styles.backgroundImage}")`);
                document.documentElement.style.setProperty('--primary-color', config.styles.primaryColor);
                document.documentElement.style.setProperty('--highlight-color', config.styles.highlightColor);
                document.documentElement.style.setProperty('--info-text-color', config.styles.infoTextColor);
            }

            renderBlocksList() {
                const list = document.getElementById('blocks-list');
                list.innerHTML = '';

                config.contentBlocks.forEach((block, index) => {
                    const item = document.createElement('div');
                    item.className = 'block-item';
                    
                    const blockTypeText = i18n.translate(`block_types.${block.type}`, block.type);
                    const editText = i18n.translate('management.edit', 'ç¼–è¾‘');
                    const toggleText = i18n.translate(block.enabled ? 'management.hide' : 'management.show', block.enabled ? 'éšè—' : 'æ˜¾ç¤º');
                    const deleteText = i18n.translate('management.delete', 'åˆ é™¤');
                    
                    item.innerHTML = `
                        <div class="block-header">
                            <div>
                                <span class="block-title">${block.title}</span>
                                <span class="block-type">${blockTypeText}</span>
                            </div>
                        </div>
                        <div class="block-controls">
                            <button class="glass-btn primary" onclick="contentManager.editBlock(${index})">${editText}</button>
                            <button class="glass-btn ${block.enabled ? 'warning' : 'success'}" onclick="contentManager.toggleBlock(${index})">${toggleText}</button>
                            <button class="glass-btn danger" onclick="contentManager.deleteBlock(${index})">${deleteText}</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            }

            editBlock(index) {
                const block = config.contentBlocks[index];
                const titlePrompt = i18n.translate('prompts.edit_title', 'ç¼–è¾‘æ ‡é¢˜:');
                const newTitle = prompt(titlePrompt, block.title);
                if (newTitle !== null) block.title = newTitle;

                switch (block.type) {
                    case 'header':
                        const greetingPrompt = i18n.translate('prompts.edit_greeting', 'ç¼–è¾‘é—®å€™è¯­:');
                        const namePrompt = i18n.translate('prompts.edit_name', 'ç¼–è¾‘å§“å:');
                        const subtitlePrompt = i18n.translate('prompts.edit_subtitle', 'ç¼–è¾‘å‰¯æ ‡é¢˜:');
                        
                        const greeting = prompt(greetingPrompt, block.content.greeting);
                        const name = prompt(namePrompt, block.content.name);
                        const subtitle = prompt(subtitlePrompt, block.content.subtitle);
                        
                        if (greeting !== null) block.content.greeting = greeting;
                        if (name !== null) block.content.name = name;
                        if (subtitle !== null) block.content.subtitle = subtitle;
                        break;
                    case 'text':
                        const textPrompt = i18n.translate('prompts.edit_text', 'ç¼–è¾‘æ–‡æœ¬:');
                        const text = prompt(textPrompt, block.content.text);
                        if (text !== null) block.content.text = text;
                        break;
                    case 'list':
                        const listPrompt = i18n.translate('prompts.edit_list', 'ç¼–è¾‘åˆ—è¡¨é¡¹ (ç”¨æ¢è¡Œåˆ†éš”):');
                        const items = prompt(listPrompt, block.content.items.join('\n'));
                        if (items !== null) block.content.items = items.split('\n').filter(item => item.trim());
                        break;
                    case 'custom':
                        const htmlPrompt = i18n.translate('prompts.edit_html', 'ç¼–è¾‘HTML:');
                        const html = prompt(htmlPrompt, block.content.html);
                        if (html !== null) block.content.html = html;
                        break;
                }

                this.applyConfig();
                this.renderBlocksList();
            }

            toggleBlock(index) {
                config.contentBlocks[index].enabled = !config.contentBlocks[index].enabled;
                this.applyConfig();
                this.renderBlocksList();
            }

            deleteBlock(index) {
                const confirmText = i18n.translate('management.confirm_delete', 'ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå†…å®¹å—å—ï¼Ÿ');
                if (confirm(confirmText)) {
                    config.contentBlocks.splice(index, 1);
                    this.applyConfig();
                    this.renderBlocksList();
                }
            }

            loadSavedConfig() {
                const saved = localStorage.getItem('selfIntroConfig');
                if (saved) {
                    try {
                        const savedConfig = JSON.parse(saved);
                        Object.assign(config, savedConfig);
                    } catch (error) {
                        console.error('åŠ è½½ä¿å­˜çš„é…ç½®å¤±è´¥:', error);
                    }
                }
            }

            async initI18n() {
                const savedLang = localStorage.getItem('lang') || 'default';
                await i18n.loadTranslations('default');
                if (savedLang !== 'default') {
                    await i18n.loadTranslations(savedLang);
                }
                i18n.currentLang = savedLang;
                document.getElementById('language-switcher').value = savedLang;
                i18n.applyTranslations();
            }
        }

        // å…¨å±€å‡½æ•°
        function togglePanel() {
            document.getElementById('management-panel').classList.toggle('show');
        }

        function addBlock() {
            const type = document.getElementById('block-type').value;
            const titleInput = document.getElementById('block-title');
            const title = titleInput.value || i18n.translate('content_defaults.new_block', 'æ–°å†…å®¹å—');

            const newBlock = {
                id: 'block_' + Date.now(),
                type: type,
                enabled: true,
                title: title,
                content: getDefaultContent(type),
                styles: {
                    backgroundColor: "rgba(255, 255, 255, 0.1)",
                    padding: "20px",
                    borderRadius: "24px"
                }
            };

            config.contentBlocks.push(newBlock);
            contentManager.applyConfig();
            contentManager.renderBlocksList();
            titleInput.value = '';
        }

        function getDefaultContent(type) {
            const defaults = i18n.translate('content_defaults', {});
            switch (type) {
                case 'header':
                    return { 
                        greeting: defaults.greeting || "è¯·è¾“å…¥é—®å€™è¯­", 
                        name: defaults.name || "è¯·è¾“å…¥å§“å", 
                        subtitle: defaults.subtitle || "è¯·è¾“å…¥å‰¯æ ‡é¢˜" 
                    };
                case 'text':
                    return { text: defaults.text || "è¯·è¾“å…¥æ–‡æœ¬å†…å®¹" };
                case 'list':
                    return { items: [defaults.list_item || "è¯·è¾“å…¥åˆ—è¡¨é¡¹1", defaults.list_item || "è¯·è¾“å…¥åˆ—è¡¨é¡¹2"] };
                case 'custom':
                    return { html: `<p class="info-text">${defaults.custom_html || "è¯·è¾“å…¥è‡ªå®šä¹‰HTML"}</p>` };
                default:
                    return {};
            }
        }

        function saveConfig() {
            localStorage.setItem('selfIntroConfig', JSON.stringify(config));
            const message = i18n.translate('management.config_saved', 'é…ç½®å·²ä¿å­˜ï¼');
            alert(message);
        }

        function exportConfig() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'self-intro-config.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedConfig = JSON.parse(e.target.result);
                    const confirmText = i18n.translate('management.import_confirm', 'å¯¼å…¥é…ç½®å°†è¦†ç›–å½“å‰è®¾ç½®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ');
                    if (confirm(confirmText)) {
                        Object.assign(config, importedConfig);
                        contentManager.applyConfig();
                        contentManager.renderBlocksList();
                        const successText = i18n.translate('management.config_imported', 'é…ç½®å¯¼å…¥æˆåŠŸï¼');
                        alert(successText);
                    }
                } catch (error) {
                    const errorText = i18n.translate('management.config_error', 'é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                    alert(errorText);
                }
            };
            reader.readAsText(file);
        }

        function resetConfig() {
            const confirmText = i18n.translate('management.confirm_reset', 'ç¡®å®šè¦é‡ç½®æ‰€æœ‰é…ç½®å—ï¼Ÿè¿™å°†æ¸…é™¤æ‰€æœ‰è‡ªå®šä¹‰å†…å®¹ã€‚');
            if (confirm(confirmText)) {
                localStorage.removeItem('selfIntroConfig');
                location.reload();
            }
        }

        // åˆå§‹åŒ–
        let contentManager;
        document.addEventListener('DOMContentLoaded', () => {
            contentManager = new ContentManager();
        });
    </script>
</body>
</html>

