<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title id="page-title">自我介绍网站</title>
    <link rel="stylesheet" href="components/style.css">
    <link rel="stylesheet" href="components/liquid-glass-block.css">
    <link rel="stylesheet" href="components/birthday.css">
    <link rel="stylesheet" href="components/splash-screen.css">
    <style>
        /* 管理面板样式 */
        .management-panel {
            position: fixed;
            top: 0;
            right: -450px;
            width: 450px;
            height: 100vh;
            background: rgba(0, 0, 0, 0.95);
            backdrop-filter: blur(20px);
            color: white;
            z-index: 10000;
            transition: right 0.3s ease;
            overflow-y: auto;
            box-shadow: -5px 0 20px rgba(0, 0, 0, 0.3);
        }
        
        .management-panel.show {
            right: 0;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.05);
        }
        
        .panel-header h3 {
            margin: 0;
            color: #a6deff;
            font-size: 18px;
        }
        
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            transition: background 0.2s;
        }
        
        .close-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .panel-content {
            padding: 20px;
        }
        
        .panel-section {
            margin-bottom: 25px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .panel-section h4 {
            margin: 0 0 15px 0;
            color: #a6deff;
            font-size: 16px;
            border-bottom: 1px solid rgba(166, 222, 255, 0.3);
            padding-bottom: 8px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: #ccc;
            font-size: 14px;
        }
        
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 6px;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            box-sizing: border-box;
            font-size: 14px;
        }
        
        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #a6deff;
            box-shadow: 0 0 0 2px rgba(166, 222, 255, 0.2);
        }
        
        .btn {
            padding: 10px 15px;
            margin: 5px 5px 5px 0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            transition: all 0.2s;
        }
        
        .btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
        }
        
        .btn-primary { background: #2196F3; color: white; }
        .btn-success { background: #4CAF50; color: white; }
        .btn-warning { background: #FF9800; color: white; }
        .btn-danger { background: #f44336; color: white; }
        .btn-info { background: #00BCD4; color: white; }
        
        .btn-full {
            width: 100%;
            margin: 5px 0;
        }
        
        .management-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            color: white;
            font-size: 20px;
            cursor: pointer;
            z-index: 9999;
            transition: all 0.2s;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }
        
        .management-toggle:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }
        
        .block-item {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.15);
            transition: all 0.2s;
        }
        
        .block-item:hover {
            background: rgba(255, 255, 255, 0.12);
            border-color: rgba(255, 255, 255, 0.25);
        }
        
        .block-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .block-title {
            font-weight: bold;
            color: #fff;
        }
        
        .block-type {
            font-size: 12px;
            color: #aaa;
            background: rgba(255, 255, 255, 0.1);
            padding: 2px 8px;
            border-radius: 12px;
        }
        
        .block-controls {
            display: flex;
            gap: 5px;
            margin-top: 10px;
        }
        
        .block-controls .btn {
            padding: 5px 10px;
            font-size: 12px;
            margin: 0;
        }
        
        .color-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .color-input-group input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }
        
        .color-input-group input[type="text"] {
            flex: 1;
        }
        
        .language-switcher {
            position: fixed;
            top: 80px;
            right: 20px;
            z-index: 9998;
            padding: 8px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            font-size: 14px;
        }
        
        .drag-handle {
            cursor: move;
            color: #aaa;
            margin-right: 10px;
        }
        
        .drag-handle:hover {
            color: #fff;
        }
        
        @media (max-width: 500px) {
            .management-panel {
                width: 100%;
                right: -100%;
            }
            
            .management-toggle {
                top: 10px;
                right: 10px;
                width: 40px;
                height: 40px;
                font-size: 16px;
            }
            
            .language-switcher {
                top: 60px;
                right: 10px;
                font-size: 12px;
                padding: 6px;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="splash-screen hidden">
        <div class="splash-content-girl">
            <div class="loader"></div>
            <p class="splash-text">加载中...</p>
        </div>
    </div>

    <!-- Language Switcher -->
    <select id="language-switcher" class="language-switcher">
        <option value="default">默认提示</option>
        <option value="en">English</option>
        <option value="ja">日本語</option>
        <option value="zh-CN">简体中文</option>
        <option value="zh-TW">繁體中文</option>
    </select>

    <!-- Management Panel -->
    <div id="management-panel" class="management-panel">
        <div class="panel-header">
            <h3>🎨 内容管理系统</h3>
            <button id="close-panel" class="close-btn">×</button>
        </div>
        <div class="panel-content">
            <!-- 页面设置 -->
            <div class="panel-section">
                <h4>📄 页面设置</h4>
                <div class="form-group">
                    <label>页面标题</label>
                    <input type="text" id="page-title-input" placeholder="请输入页面标题">
                </div>
                <div class="form-group">
                    <label>背景图片URL</label>
                    <input type="text" id="background-input" placeholder="请输入背景图片URL或路径">
                </div>
            </div>
            
            <!-- 内容块管理 -->
            <div class="panel-section">
                <h4>📝 内容块管理</h4>
                <div class="form-group">
                    <label>内容块类型</label>
                    <select id="block-type">
                        <option value="header">标题块</option>
                        <option value="text">文本块</option>
                        <option value="list">列表块</option>
                        <option value="custom">自定义块</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>内容块标题</label>
                    <input type="text" id="block-title" placeholder="请输入内容块标题">
                </div>
                <button class="btn btn-success btn-full" onclick="addBlock()">+ 添加内容块</button>
                
                <div id="blocks-list" style="margin-top: 20px;"></div>
            </div>
            
            <!-- 样式设置 -->
            <div class="panel-section">
                <h4>🎨 样式设置</h4>
                <div class="form-group">
                    <label>主色调</label>
                    <div class="color-input-group">
                        <input type="color" id="primary-color" value="#a6deff">
                        <input type="text" id="primary-color-text" value="#a6deff">
                    </div>
                </div>
                <div class="form-group">
                    <label>高亮色</label>
                    <div class="color-input-group">
                        <input type="color" id="highlight-color" value="#dbA6ff">
                        <input type="text" id="highlight-color-text" value="#dbA6ff">
                    </div>
                </div>
                <div class="form-group">
                    <label>文本色</label>
                    <div class="color-input-group">
                        <input type="color" id="text-color" value="#ffa6d3">
                        <input type="text" id="text-color-text" value="#ffa6d3">
                    </div>
                </div>
            </div>
            
            <!-- 配置管理 -->
            <div class="panel-section">
                <h4>💾 配置管理</h4>
                <button class="btn btn-primary btn-full" onclick="saveConfig()">💾 保存配置</button>
                <button class="btn btn-warning btn-full" onclick="exportConfig()">📤 导出配置</button>
                <button class="btn btn-info btn-full" onclick="document.getElementById('import-file').click()">📥 导入配置</button>
                <input type="file" id="import-file" style="display: none" accept=".json" onchange="importConfig(event)">
                <button class="btn btn-danger btn-full" onclick="resetConfig()">🔄 重置配置</button>
            </div>
        </div>
    </div>
    
    <!-- Management Toggle Button -->
    <button class="management-toggle" onclick="togglePanel()">⚙️</button>
    
    <!-- Content Container -->
    <div id="content-container"></div>

    <!-- Scripts -->
    <script src="components/birthday.js"></script>
    <script src="components/splash-screen.js"></script>
    <script type="module" src="anime/sakura.js"></script>
    
    <script>
        // 全局配置对象
        let config = {
            pageInfo: {
                title: "我的自我介绍",
                language: "default"
            },
            styles: {
                backgroundImage: "components/background.jpeg",
                primaryColor: "#a6deff",
                highlightColor: "#dbA6ff",
                infoTextColor: "#ffa6d3",
                fontFamily: "KleeOne-Regular"
            },
            contentBlocks: [
                {
                    id: "header",
                    type: "header",
                    enabled: true,
                    title: "个人信息",
                    content: {
                        greeting: "请输入问候语",
                        name: "请输入您的姓名",
                        subtitle: "请输入副标题"
                    },
                    styles: {
                        textAlign: "center",
                        backgroundColor: "rgba(255, 255, 255, 0.1)",
                        padding: "20px",
                        borderRadius: "24px"
                    }
                },
                {
                    id: "about",
                    type: "text",
                    enabled: true,
                    title: "🌟 关于我",
                    content: {
                        text: "请输入关于您的介绍文本。您可以在这里写任何想要分享的内容。"
                    },
                    styles: {
                        backgroundColor: "rgba(255, 255, 255, 0.1)",
                        padding: "20px",
                        borderRadius: "24px"
                    }
                }
            ]
        };

        // 国际化支持
        const i18n = {
            currentLang: 'default',
            translations: {},

            async loadTranslations(lang) {
                try {
                    const response = await fetch(`./locales/${lang}.json`);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    this.translations[lang] = await response.json();
                } catch (error) {
                    console.error(`Could not load translations for ${lang}:`, error);
                    if (lang !== 'default' && !this.translations['default']) {
                        await this.loadTranslations('default');
                    }
                }
            },

            translate(key, defaultValue = '') {
                const keys = key.split('.');
                let result = this.translations[this.currentLang];
                for (const k of keys) {
                    if (result && typeof result === 'object' && k in result) {
                        result = result[k];
                    } else {
                        result = this.translations['default'];
                        for (const ek of keys) {
                            if (result && typeof result === 'object' && ek in result) {
                                result = result[ek];
                            } else {
                                return defaultValue;
                            }
                        }
                        break;
                    }
                }
                return result || defaultValue;
            },

            async setLanguage(lang) {
                if (!this.translations[lang]) {
                    await this.loadTranslations(lang);
                }
                this.currentLang = lang;
                localStorage.setItem('lang', lang);
                this.applyTranslations();
            },

            applyTranslations() {
                document.querySelectorAll('[data-i18n]').forEach(element => {
                    const key = element.getAttribute('data-i18n');
                    const defaultValue = element.getAttribute('data-i18n-default') || '';
                    element.innerHTML = this.translate(key, defaultValue);
                });
            }
        };

        // 内容渲染器
        class ContentRenderer {
            constructor(container) {
                this.container = container;
            }

            renderBlock(block) {
                if (!block.enabled) return null;

                const section = document.createElement('div');
                section.className = 'section';
                section.id = `block-${block.id}`;
                section.style.marginBottom = '25px';

                const glassContainer = document.createElement('div');
                glassContainer.className = 'glass-container-apple';
                
                // 应用自定义样式
                if (block.styles) {
                    Object.assign(glassContainer.style, block.styles);
                }

                // 渲染标题
                if (block.title) {
                    const title = document.createElement('h3');
                    title.className = 'section-title';
                    title.textContent = block.title;
                    glassContainer.appendChild(title);
                }

                // 根据类型渲染内容
                switch (block.type) {
                    case 'header':
                        this.renderHeader(glassContainer, block.content);
                        section.style.cssText = 'display: flex; flex-direction: column; justify-content: center; align-items: center; min-height: 100vh; text-align: center;';
                        break;
                    case 'text':
                        this.renderText(glassContainer, block.content);
                        break;
                    case 'list':
                        this.renderList(glassContainer, block.content);
                        break;
                    case 'custom':
                        this.renderCustom(glassContainer, block.content);
                        break;
                }

                section.appendChild(glassContainer);
                return section;
            }

            renderHeader(container, content) {
                if (content.greeting) {
                    const greeting = document.createElement('p');
                    greeting.className = 'info-text';
                    greeting.textContent = content.greeting;
                    container.appendChild(greeting);
                }

                if (content.name) {
                    const name = document.createElement('p');
                    const nameSpan = document.createElement('strong');
                    nameSpan.className = 'highlight';
                    nameSpan.textContent = content.name;
                    name.appendChild(nameSpan);
                    container.appendChild(name);
                }

                if (content.subtitle) {
                    const subtitle = document.createElement('p');
                    subtitle.className = 'info-text';
                    subtitle.textContent = content.subtitle;
                    container.appendChild(subtitle);
                }
            }

            renderText(container, content) {
                const text = document.createElement('p');
                text.className = 'info-text';
                text.textContent = content.text;
                container.appendChild(text);
            }

            renderList(container, content) {
                const list = document.createElement('ul');
                content.items.forEach(item => {
                    const li = document.createElement('li');
                    li.className = 'info-text';
                    li.textContent = item;
                    list.appendChild(li);
                });
                container.appendChild(list);
            }

            renderCustom(container, content) {
                container.innerHTML += content.html;
            }

            renderAll() {
                this.container.innerHTML = '';

                // 添加樱花画布
                const canvas = document.createElement('canvas');
                canvas.id = 'sakura-canvas';
                canvas.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: -1;';
                this.container.appendChild(canvas);

                // 渲染所有启用的内容块
                config.contentBlocks.forEach(block => {
                    if (block.enabled) {
                        const blockElement = this.renderBlock(block);
                        if (blockElement) {
                            this.container.appendChild(blockElement);
                        }
                    }
                });
            }
        }

        // 内容管理器
        class ContentManager {
            constructor() {
                this.renderer = new ContentRenderer(document.getElementById('content-container'));
                this.init();
            }

            init() {
                this.bindEvents();
                this.loadSavedConfig();
                this.applyConfig();
                this.renderBlocksList();
                this.initI18n();
            }

            bindEvents() {
                // 页面设置事件
                document.getElementById('page-title-input').addEventListener('input', (e) => {
                    config.pageInfo.title = e.target.value;
                    document.title = e.target.value;
                });

                document.getElementById('background-input').addEventListener('input', (e) => {
                    config.styles.backgroundImage = e.target.value;
                    this.applyStyles();
                });

                // 颜色设置事件
                this.bindColorEvents('primary-color', 'primaryColor');
                this.bindColorEvents('highlight-color', 'highlightColor');
                this.bindColorEvents('text-color', 'infoTextColor');

                // 面板控制
                document.getElementById('close-panel').addEventListener('click', () => {
                    document.getElementById('management-panel').classList.remove('show');
                });

                // 语言切换
                document.getElementById('language-switcher').addEventListener('change', (e) => {
                    i18n.setLanguage(e.target.value);
                });
            }

            bindColorEvents(inputId, configKey) {
                const colorInput = document.getElementById(inputId);
                const textInput = document.getElementById(inputId + '-text');

                colorInput.addEventListener('input', (e) => {
                    const color = e.target.value;
                    config.styles[configKey] = color;
                    textInput.value = color;
                    this.applyStyles();
                });

                textInput.addEventListener('input', (e) => {
                    const color = e.target.value;
                    if (/^#[0-9A-F]{6}$/i.test(color)) {
                        config.styles[configKey] = color;
                        colorInput.value = color;
                        this.applyStyles();
                    }
                });
            }

            applyConfig() {
                // 应用页面标题
                document.title = config.pageInfo.title;
                document.getElementById('page-title-input').value = config.pageInfo.title;

                // 应用背景
                document.getElementById('background-input').value = config.styles.backgroundImage;

                // 应用颜色
                document.getElementById('primary-color').value = config.styles.primaryColor;
                document.getElementById('primary-color-text').value = config.styles.primaryColor;
                document.getElementById('highlight-color').value = config.styles.highlightColor;
                document.getElementById('highlight-color-text').value = config.styles.highlightColor;
                document.getElementById('text-color').value = config.styles.infoTextColor;
                document.getElementById('text-color-text').value = config.styles.infoTextColor;

                this.applyStyles();
                this.renderer.renderAll();
            }

            applyStyles() {
                document.body.style.setProperty('--background-image', `url("${config.styles.backgroundImage}")`);
                document.documentElement.style.setProperty('--primary-color', config.styles.primaryColor);
                document.documentElement.style.setProperty('--highlight-color', config.styles.highlightColor);
                document.documentElement.style.setProperty('--info-text-color', config.styles.infoTextColor);
            }

            renderBlocksList() {
                const list = document.getElementById('blocks-list');
                list.innerHTML = '';

                config.contentBlocks.forEach((block, index) => {
                    const item = document.createElement('div');
                    item.className = 'block-item';
                    item.innerHTML = `
                        <div class="block-header">
                            <div>
                                <span class="drag-handle">⋮⋮</span>
                                <span class="block-title">${block.title}</span>
                                <span class="block-type">${block.type}</span>
                            </div>
                        </div>
                        <div class="block-controls">
                            <button class="btn btn-primary" onclick="contentManager.editBlock(${index})">编辑</button>
                            <button class="btn ${block.enabled ? 'btn-warning' : 'btn-success'}" onclick="contentManager.toggleBlock(${index})">${block.enabled ? '隐藏' : '显示'}</button>
                            <button class="btn btn-danger" onclick="contentManager.deleteBlock(${index})">删除</button>
                        </div>
                    `;
                    list.appendChild(item);
                });
            }

            editBlock(index) {
                const block = config.contentBlocks[index];
                const newTitle = prompt('编辑标题:', block.title);
                if (newTitle !== null) block.title = newTitle;

                switch (block.type) {
                    case 'header':
                        const greeting = prompt('编辑问候语:', block.content.greeting);
                        const name = prompt('编辑姓名:', block.content.name);
                        const subtitle = prompt('编辑副标题:', block.content.subtitle);
                        if (greeting !== null) block.content.greeting = greeting;
                        if (name !== null) block.content.name = name;
                        if (subtitle !== null) block.content.subtitle = subtitle;
                        break;
                    case 'text':
                        const text = prompt('编辑文本:', block.content.text);
                        if (text !== null) block.content.text = text;
                        break;
                    case 'list':
                        const items = prompt('编辑列表项 (用换行分隔):', block.content.items.join('\n'));
                        if (items !== null) block.content.items = items.split('\n').filter(item => item.trim());
                        break;
                    case 'custom':
                        const html = prompt('编辑HTML:', block.content.html);
                        if (html !== null) block.content.html = html;
                        break;
                }

                this.applyConfig();
                this.renderBlocksList();
            }

            toggleBlock(index) {
                config.contentBlocks[index].enabled = !config.contentBlocks[index].enabled;
                this.applyConfig();
                this.renderBlocksList();
            }

            deleteBlock(index) {
                if (confirm('确定要删除这个内容块吗？')) {
                    config.contentBlocks.splice(index, 1);
                    this.applyConfig();
                    this.renderBlocksList();
                }
            }

            loadSavedConfig() {
                const saved = localStorage.getItem('selfIntroConfig');
                if (saved) {
                    try {
                        const savedConfig = JSON.parse(saved);
                        Object.assign(config, savedConfig);
                    } catch (error) {
                        console.error('加载保存的配置失败:', error);
                    }
                }
            }

            async initI18n() {
                const savedLang = localStorage.getItem('lang') || 'default';
                await i18n.loadTranslations('default');
                if (savedLang !== 'default') {
                    await i18n.loadTranslations(savedLang);
                }
                i18n.currentLang = savedLang;
                document.getElementById('language-switcher').value = savedLang;
                i18n.applyTranslations();
            }
        }

        // 全局函数
        function togglePanel() {
            document.getElementById('management-panel').classList.toggle('show');
        }

        function addBlock() {
            const type = document.getElementById('block-type').value;
            const title = document.getElementById('block-title').value || '新内容块';

            const newBlock = {
                id: 'block_' + Date.now(),
                type: type,
                enabled: true,
                title: title,
                content: getDefaultContent(type),
                styles: {
                    backgroundColor: "rgba(255, 255, 255, 0.1)",
                    padding: "20px",
                    borderRadius: "24px"
                }
            };

            config.contentBlocks.push(newBlock);
            contentManager.applyConfig();
            contentManager.renderBlocksList();
            document.getElementById('block-title').value = '';
        }

        function getDefaultContent(type) {
            switch (type) {
                case 'header':
                    return { greeting: "请输入问候语", name: "请输入姓名", subtitle: "请输入副标题" };
                case 'text':
                    return { text: "请输入文本内容" };
                case 'list':
                    return { items: ["请输入列表项1", "请输入列表项2"] };
                case 'custom':
                    return { html: '<p class="info-text">请输入自定义HTML</p>' };
                default:
                    return {};
            }
        }

        function saveConfig() {
            localStorage.setItem('selfIntroConfig', JSON.stringify(config));
            alert('配置已保存！');
        }

        function exportConfig() {
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'self-intro-config.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        function importConfig(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedConfig = JSON.parse(e.target.result);
                    if (confirm('导入配置将覆盖当前设置，确定继续吗？')) {
                        Object.assign(config, importedConfig);
                        contentManager.applyConfig();
                        contentManager.renderBlocksList();
                        alert('配置导入成功！');
                    }
                } catch (error) {
                    alert('配置文件格式错误！');
                }
            };
            reader.readAsText(file);
        }

        function resetConfig() {
            if (confirm('确定要重置所有配置吗？这将清除所有自定义内容。')) {
                localStorage.removeItem('selfIntroConfig');
                location.reload();
            }
        }

        // 初始化
        let contentManager;
        document.addEventListener('DOMContentLoaded', () => {
            contentManager = new ContentManager();
        });
    </script>
</body>
</html>

